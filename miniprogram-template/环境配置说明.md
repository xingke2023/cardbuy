# 小程序环境配置说明

## 🔧 如何切换开发/生产环境

在 `app.js` 文件中，只需要修改一行代码：

```javascript
globalData: {
  // 开发模式开关：true = 本地开发，false = 生产环境
  isDev: true,  // 👈 修改这里
  ...
}
```

### 本地开发模式

```javascript
isDev: true,  // 连接本地后端 http://localhost:8001
```

**用途：**
- 本地调试
- 开发新功能
- 测试修改

**注意：**
- 需要在微信开发者工具中勾选"不校验合法域名"
- 确保本地 Laravel 服务器在运行：`php artisan serve --port=8001`

---

### 生产环境模式

```javascript
isDev: false,  // 连接线上服务器 https://cardbuy.xingke888.com
```

**用途：**
- 提交审核
- 正式发布
- 线上运行

**注意：**
- 必须配置合法域名
- 必须使用 HTTPS

---

## 📋 完整配置

### app.js

```javascript
App({
  globalData: {
    // 开发模式开关：true = 本地开发，false = 生产环境
    isDev: true,  // 👈 只需要改这一行

    // 根据开发模式自动选择配置
    get apiBase() {
      return this.isDev
        ? 'http://localhost:8001/api/v1'           // 本地开发
        : 'https://cardbuy.xingke888.com/api/v1'  // 生产环境
    },

    get webBase() {
      return this.isDev
        ? 'http://localhost:8001'                  // 本地开发
        : 'https://cardbuy.xingke888.com'         // 生产环境
    }
  }
})
```

---

## 🚀 快速切换

### 本地开发

1. 打开 `app.js`
2. 设置 `isDev: true`
3. 启动本地服务器：`php artisan serve --port=8001`
4. 在开发者工具中勾选"不校验合法域名"
5. 开始开发 ✅

### 发布生产

1. 打开 `app.js`
2. 设置 `isDev: false`
3. 取消勾选"不校验合法域名"
4. 上传代码
5. 提交审核 ✅

---

## 🔍 如何确认当前环境

启动小程序时，在控制台会显示：

```
小程序启动
========================================
当前模式: 本地开发
API地址: http://localhost:8001/api/v1
WebView地址: http://localhost:8001
========================================
```

或

```
小程序启动
========================================
当前模式: 生产环境
API地址: https://cardbuy.xingke888.com/api/v1
WebView地址: https://cardbuy.xingke888.com
========================================
```

---

## ⚠️ 常见问题

### 1. WebView 打不开页面

**本地开发：**
- 确保勾选了"不校验合法域名"
- 确保 Laravel 服务器在运行

**生产环境：**
- 确保服务器配置了 HTTPS
- 确保配置了业务域名

### 2. API 请求失败

**检查清单：**
- ✅ `isDev` 设置正确
- ✅ 对应的服务器在运行
- ✅ 开发者工具设置正确
- ✅ 控制台显示的地址正确

### 3. 提交审核前

**必须做：**
- ✅ 将 `isDev` 改为 `false`
- ✅ 取消勾选"不校验合法域名"
- ✅ 测试所有功能
- ✅ 检查控制台显示"生产环境"

---

## 💡 提示

- 本地开发时，改动后保存即可，无需重启
- 切换环境后，建议重启小程序确保配置生效
- 提交代码前，记得将 `isDev` 设为 `false`
