# 🎉 Cardbase 小程序 - 开始使用

## ✅ 已完成的准备工作

### 1. 数据库配置
- ✅ 数据库连接：MySQL (127.0.0.1:3306)
- ✅ 数据库名称：cardbase
- ✅ 数据表已迁移完成

### 2. 测试账号（密码已重置）

| 类型 | 邮箱 | 密码 | 说明 |
|------|------|------|------|
| 普通用户 | customer@cardbase.com | password123 | 王永明 |
| 教师账号 | teacher1@cardbase.com | password123 | 李老师（已认证） |
| 教师账号 | teacher2@cardbase.com | password123 | 王专家（已认证） |

### 3. API 接口
- ✅ API 路由已注册
- ✅ 登录接口测试成功
- ✅ Token 认证正常工作

### 4. Laravel 开发服务器
- ✅ 服务器已启动
- ✅ 访问地址：**http://localhost:8001**
- ✅ API 地址：**http://localhost:8001/api/v1**

---

## 🚀 现在开始使用小程序

### 步骤 1：打开微信开发者工具

1. 启动 **微信开发者工具**
2. 选择 **"导入项目"**
3. 选择目录：
   ```
   /Users/mi/github/my_laravel/miniprogram-template
   ```
4. AppID 选择：**使用测试号**
5. 点击 **"导入"**

### 步骤 2：配置小程序（重要！）

打开 `app.js`，修改域名配置：

```javascript
globalData: {
  apiBase: 'http://localhost:8001/api/v1',  // ← 已经配置为本地地址
  webBase: 'http://localhost:8001',
}
```

### 步骤 3：关闭域名校验

在微信开发者工具中：
1. 点击右上角 **"详情"**
2. 选择 **"本地设置"**
3. 勾选 **"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**

### 步骤 4：编译运行

1. 点击微信开发者工具顶部的 **"编译"** 按钮
2. 应该会看到一个漂亮的登录页面
3. 输入测试账号登录：
   - 邮箱：`teacher1@cardbase.com`
   - 密码：`password123`

### 步骤 5：测试功能

登录成功后：
- 会自动跳转到 WebView
- WebView 会加载 Laravel 首页（http://localhost:8001）
- 所有业务操作都在 WebView 中完成

---

## 📂 项目目录结构

```
my_laravel/
├── app/                          # Laravel 应用代码
│   └── Http/Controllers/Api/     # API 控制器
│       ├── AuthController.php    # 登录/注册
│       ├── TeacherController.php # 教师管理
│       ├── OrderController.php   # 订单管理
│       └── ServiceController.php # 服务管理
│
├── routes/
│   ├── web.php                   # Web 路由
│   └── api.php                   # API 路由 ✨
│
├── miniprogram-template/         # 小程序代码 ✨
│   ├── app.js                    # 全局配置
│   ├── app.json                  # 页面注册
│   └── pages/
│       ├── login/                # 登录页面（原生）
│       ├── payment/              # 支付页面（原生）
│       └── webview/              # WebView（所有业务页面）
│
├── 小程序开发指南.md              # 详细开发文档 ✨
└── 开始使用.md                    # 本文件 ✨
```

---

## 🔧 常用命令

### Laravel 相关
```bash
# 启动开发服务器
php artisan serve

# 查看路由列表
php artisan route:list --path=api

# 清除缓存
php artisan cache:clear
php artisan route:clear
php artisan config:clear

# 运行迁移
php artisan migrate
```

### 停止开发服务器
如果需要停止 Laravel 服务器，可以使用：
```bash
# 查找进程
lsof -ti:8001

# 停止进程
kill $(lsof -ti:8001)
```

---

## 📡 API 接口测试

### 测试登录接口（使用 curl）
```bash
curl -X POST http://localhost:8001/api/v1/login \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "email": "teacher1@cardbase.com",
    "password": "password123"
  }'
```

### 测试用户信息接口
```bash
# 先获取 token（从登录接口响应中复制）
TOKEN="your_token_here"

curl -X GET http://localhost:8001/api/v1/user \
  -H "Authorization: Bearer $TOKEN" \
  -H "Accept: application/json"
```

---

## 🎨 小程序架构说明

### 极简混合架构

```
┌─────────────────────────────────────┐
│         小程序入口                   │
│      (登录页面 - 原生)              │
└──────────────┬──────────────────────┘
               │ 登录成功
               ↓
┌─────────────────────────────────────┐
│         WebView 页面                 │
│   (加载 Laravel 所有业务页面)       │
│                                      │
│  • 教师列表                          │
│  • 教师详情                          │
│  • 订单管理                          │
│  • 服务管理                          │
│  • 个人中心                          │
│  • ... 所有其他页面                 │
└──────────────┬──────────────────────┘
               │ 需要支付
               ↓
┌─────────────────────────────────────┐
│       支付页面 (原生)                │
│    (调用微信支付 API)               │
└──────────────┬──────────────────────┘
               │ 支付完成
               ↓
         返回 WebView
```

### 优势
- ✅ **开发快**：90% 页面直接用 WebView，无需重写
- ✅ **维护简单**：只需维护一套 Laravel 代码
- ✅ **体验完整**：登录和支付使用原生，保证体验

---

## ❓ 常见问题

### Q1: 小程序白屏？
A: 检查是否勾选了"不校验合法域名"，并确认 Laravel 服务器正在运行。

### Q2: 登录失败？
A: 检查 `app.js` 中的 apiBase 是否正确配置为 `http://localhost:8001/api/v1`

### Q3: WebView 无法加载？
A: 检查 webBase 是否正确，确认 Laravel 服务器在 http://localhost:8001 运行。

### Q4: 如何查看 API 日志？
A: Laravel 日志在 `storage/logs/laravel.log`

### Q5: 端口 8001 被占用？
A: 修改启动命令：`php artisan serve --port=8002`，然后修改小程序 `app.js` 中的配置。

---

## 📚 下一步

1. **熟悉功能**：登录后在 WebView 中浏览各个页面
2. **查看文档**：详细阅读 `小程序开发指南.md`
3. **自定义开发**：根据需求修改 Laravel 页面
4. **集成支付**：参考文档实现微信支付
5. **准备上线**：部署到 HTTPS 服务器，配置小程序域名

---

## 🎯 当前状态

- ✅ Laravel 后端：已启动（http://localhost:8001）
- ✅ API 接口：正常工作
- ✅ 测试账号：已准备好
- ✅ 小程序模板：可以直接导入使用
- ⏳ 等待你：打开微信开发者工具开始测试！

---

**开发愉快！🚀**

如有问题，参考 `小程序开发指南.md` 或查看 Laravel 日志。
